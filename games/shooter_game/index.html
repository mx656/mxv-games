<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MXV Shooter</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: linear-gradient(#0b0b2f, #1e1e50);
    color: white;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: #111;
    border: 2px solid #4caf50;
    border-radius: 10px;
  }
  #scoreBoard {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 20px;
  }
  #upgradeInfo {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 16px;
  }
</style>
</head>
<body>

<div id="scoreBoard">Score: 0 | High Score: 0</div>
<div id="upgradeInfo">Upgrade: Speed 1 | Bullets 1</div>
<canvas id="gameCanvas" width="500" height="600"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let player = { x: 225, y: 550, width: 50, height: 20, speed: 5 };
let bullets = [];
let enemies = [];
let score = 0;
let highScore = localStorage.getItem('shooterHighScore') || 0;
let gameOver = false;

// Upgrades
let bulletSpeed = 7;
let bulletCount = 1;
let playerSpeed = 5;

// Load sounds
const shootSound = new Audio('https://freesound.org/data/previews/320/320181_5260878-lq.mp3');
const hitSound = new Audio('https://freesound.org/data/previews/256/256113_3263906-lq.mp3');
const bgMusic = new Audio('https://freesound.org/data/previews/414/414209_5121236-lq.mp3');
bgMusic.loop = true;
bgMusic.volume = 0.2;
bgMusic.play().catch(()=>{}); // autoplay might be blocked

// Controls
let keys = {};
document.addEventListener('keydown', e => { keys[e.key] = true; });
document.addEventListener('keyup', e => { keys[e.key] = false; });

// Touch controls for mobile
canvas.addEventListener('touchstart', e => {
  const touch = e.touches[0];
  if(touch.clientX < canvas.width/2) player.x -= player.speed*2;
  else player.x += player.speed*2;
});

function shoot() {
  for(let i=0;i<bulletCount;i++){
    bullets.push({ x: player.x + player.width/2 - 5, y: player.y - i*10, width: 5, height: 10 });
  }
  shootSound.play().catch(()=>{});
}

function spawnEnemy() {
  const x = Math.random() * (canvas.width - 40);
  enemies.push({ x, y: 0, width: 40, height: 40, speed: 2 + Math.random()*2 });
}

function drawPlayer() {
  ctx.fillStyle = '#4caf50';
  ctx.fillRect(player.x, player.y, player.width, player.height);
}

function drawBullets() {
  ctx.fillStyle = '#ff0';
  bullets.forEach(b => ctx.fillRect(b.x, b.y, b.width, b.height));
}

function drawEnemies() {
  ctx.fillStyle = '#f44336';
  enemies.forEach(e => ctx.fillRect(e.x, e.y, e.width, e.height));
}

function movePlayer() {
  if(keys['ArrowLeft'] || keys['a']) player.x -= player.speed;
  if(keys['ArrowRight'] || keys['d']) player.x += player.speed;
  player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
}

function moveBullets() {
  bullets.forEach(b => b.y -= bulletSpeed);
  bullets = bullets.filter(b => b.y + b.height > 0);
}

function moveEnemies() {
  enemies.forEach(e => e.y += e.speed);
  enemies.forEach(e => {
    if(e.y + e.height >= canvas.height){
      gameOver = true;
    }
  });
}

function checkCollisions() {
  bullets.forEach((b,i) => {
    enemies.forEach((e,j) => {
      if(b.x < e.x + e.width && b.x + b.width > e.x &&
         b.y < e.y + e.height && b.y + b.height > e.y){
          enemies.splice(j,1);
          bullets.splice(i,1);
          score++;
          hitSound.play().catch(()=>{});
          if(score > highScore){
            highScore = score;
            localStorage.setItem('shooterHighScore', highScore);
          }
      }
    });
  });
}

function drawScore() {
  document.getElementById('scoreBoard').innerText = `Score: ${score} | High Score: ${highScore}`;
  document.getElementById('upgradeInfo').innerText = `Upgrade: Speed ${playerSpeed} | Bullets ${bulletCount}`;
}

function gameLoop() {
  if(gameOver){
    ctx.fillStyle = 'white';
    ctx.font = '40px Arial';
    ctx.fillText('GAME OVER', 100, 300);
    return;
  }

  ctx.clearRect(0,0,canvas.width,canvas.height);
  movePlayer();
  moveBullets();
  moveEnemies();
  checkCollisions();
  drawPlayer();
  drawBullets();
  drawEnemies();
  drawScore();
  requestAnimationFrame(gameLoop);
}

// Spawn enemies every 1 second
setInterval(spawnEnemy, 1000);

// Shoot every 300ms if space is held
setInterval(()=>{ if(keys[' '] || keys['Spacebar']) shoot(); }, 300);

gameLoop();
</script>
</body>
</html>
